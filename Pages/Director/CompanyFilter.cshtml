@page
@model ShiftManager.Pages.Director.CompanyFilterModel
@{
    Layout = "_Layout";
}
<h2>Company Filter</h2>
<p style="color: var(--muted); margin-bottom: 2rem;">
    Select which companies you want to see in calendars, requests, and dashboards.
    Leave all unchecked to see all assigned companies.
</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: var(--success); color: white; border-radius: 0.5rem;">
        @TempData["SuccessMessage"]
    </div>
}

<div class="card">
    <h3 style="margin-top:0">Your Assigned Companies</h3>

    <form method="post" asp-page-handler="SetFilter">
        @Html.AntiForgeryToken()

        <div style="display: grid; gap: 1rem; margin-bottom: 1rem;">
            @foreach (var company in Model.AssignedCompanies)
            {
                var isSelected = Model.SelectedCompanyIds.Contains(company.Id);
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem; background: var(--surface); border-radius: 0.5rem; cursor: pointer;">
                    <input type="checkbox" name="CompanyIds" value="@company.Id" checked="@isSelected" />
                    <div>
                        <strong>@company.Name</strong>
                        @if (!string.IsNullOrEmpty(company.Slug))
                        {
                            <span style="color: var(--muted); margin-left: 0.5rem;">
                                (<code>@company.Slug</code>)
                            </span>
                        }
                        @if (!string.IsNullOrEmpty(company.DisplayName) && company.DisplayName != company.Name)
                        {
                            <div style="color: var(--muted); font-size: 0.9rem;">@company.DisplayName</div>
                        }
                    </div>
                </label>
            }
        </div>

        <div style="display: flex; gap: 0.5rem;">
            <button type="submit" class="btn btn-primary">Apply Filter</button>
            <button type="submit" formaction="?handler=ClearFilter" class="btn btn-ghost">Show All Companies</button>
        </div>
    </form>
</div>

<div style="margin-top: 1rem; padding: 1rem; background: var(--surface); border-left: 4px solid var(--primary); border-radius: 0.5rem;">
    <small style="color: var(--muted);">
        <strong>Note:</strong> The company filter applies to:
        <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
            <li>Calendar views (only shows shifts from selected companies)</li>
            <li>Request lists (only shows requests from selected companies)</li>
            <li>Dashboards and reports</li>
        </ul>
        This filter is saved in your browser and persists across sessions.
    </small>
</div>
