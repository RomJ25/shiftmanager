@page
@model ShiftManager.Pages.Director.ViewAsModeModel
@{
    Layout = "_Layout";
}
<h2>View as Manager Mode</h2>
<p style="color: var(--muted); margin-bottom: 2rem;">
    Enter "View as Manager" mode to scope your view to a single company with Manager-level permissions.
    This is useful for troubleshooting or understanding the Manager experience.
</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: var(--success); color: white; border-radius: 0.5rem;">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error" style="margin-bottom: 2rem; padding: 1rem; background: var(--danger); color: white; border-radius: 0.5rem;">
        @TempData["ErrorMessage"]
    </div>
}

@if (Model.IsCurrentlyViewing)
{
    <div class="card" style="border: 2px solid var(--warning); background: var(--surface);">
        <h3 style="margin-top:0; color: var(--warning);">⚠️ Currently in View as Manager Mode</h3>
        <p>You are viewing as Manager of: <strong>@Model.CurrentCompanyName</strong></p>
        <p style="color: var(--muted); margin-bottom: 1rem;">
            Your view is scoped to this company only. All other companies are hidden.
            Your permissions match Manager level for this company.
        </p>
        <form method="post" asp-page-handler="Exit">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-primary">Exit View as Manager Mode</button>
        </form>
    </div>
}
else
{
    <div class="card">
        <h3 style="margin-top:0">Select Company to View</h3>
        <p style="color: var(--muted); margin-bottom: 1rem;">
            Choose a company to view as Manager. While in this mode:
        </p>
        <ul style="color: var(--muted); margin-bottom: 1.5rem;">
            <li>Only this company's data will be visible</li>
            <li>Your permissions will match Manager level</li>
            <li>You can see exactly what a Manager sees for this company</li>
            <li>All other companies will be hidden</li>
        </ul>

        @if (Model.AssignedCompanies.Any())
        {
            <div style="display: grid; gap: 0.5rem;">
                @foreach (var company in Model.AssignedCompanies)
                {
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--surface); border-radius: 0.5rem;">
                        <div>
                            <strong>@company.Name</strong>
                            @if (!string.IsNullOrEmpty(company.Slug))
                            {
                                <span style="color: var(--muted); margin-left: 0.5rem;">
                                    (<code>@company.Slug</code>)
                                </span>
                            }
                        </div>
                        <form method="post" asp-page-handler="Enter" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="companyId" value="@company.Id" />
                            <button type="submit" class="btn btn-primary" style="font-size: 0.9rem;">
                                View as Manager
                            </button>
                        </form>
                    </div>
                }
            </div>
        }
        else
        {
            <p style="color: var(--muted); text-align: center; padding: 2rem;">
                You are not assigned to any companies yet.
            </p>
        }
    </div>
}

<div style="margin-top: 1rem; padding: 1rem; background: var(--surface); border-left: 4px solid var(--warning); border-radius: 0.5rem;">
    <small style="color: var(--muted);">
        <strong>Important:</strong> View as Manager mode is for demonstration and troubleshooting purposes.
        The mode will automatically expire after 8 hours or when you explicitly exit.
    </small>
</div>
