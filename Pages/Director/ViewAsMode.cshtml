@page
@using Microsoft.Extensions.Localization
@using ShiftManager.Resources
@inject IStringLocalizer<SharedResources> Localizer
@model ShiftManager.Pages.Director.ViewAsModeModel
@{
    Layout = "_Layout";
}
<h2>@Localizer["ViewAsManagerMode"]</h2>
<p style="color: var(--muted); margin-bottom: 2rem;">
    @Localizer["ViewAsModeDescription"]
</p>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: var(--success); color: white; border-radius: 0.5rem;">
        @TempData["SuccessMessage"]
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error" style="margin-bottom: 2rem; padding: 1rem; background: var(--danger); color: white; border-radius: 0.5rem;">
        @TempData["ErrorMessage"]
    </div>
}

@if (Model.IsCurrentlyViewing)
{
    <div class="card" style="border: 2px solid var(--warning); background: var(--surface);">
        <h3 style="margin-top:0; color: var(--warning);">@Localizer["CurrentlyInViewAsManagerMode"]</h3>
        <p>@Localizer["YouAreViewingAsManagerOf"] <strong>@Model.CurrentCompanyName</strong></p>
        <p style="color: var(--muted); margin-bottom: 1rem;">
            @Localizer["ViewScopedToCompany"]
        </p>
        <form method="post" asp-page-handler="Exit">
            @Html.AntiForgeryToken()
            <button type="submit" class="btn btn-primary">@Localizer["ExitViewAsManagerMode"]</button>
        </form>
    </div>
}
else
{
    <div class="card">
        <h3 style="margin-top:0">@Localizer["SelectCompanyToView"]</h3>
        <p style="color: var(--muted); margin-bottom: 1rem;">
            @Localizer["ChooseCompanyViewAsManager"]
        </p>
        <ul style="color: var(--muted); margin-bottom: 1.5rem;">
            <li>@Localizer["OnlyThisCompanyDataVisible"]</li>
            <li>@Localizer["PermissionsMatchManagerLevel"]</li>
            <li>@Localizer["SeeWhatManagerSees"]</li>
            <li>@Localizer["AllOtherCompaniesHidden"]</li>
        </ul>

        @if (Model.AssignedCompanies.Any())
        {
            <div style="display: grid; gap: 0.5rem;">
                @foreach (var company in Model.AssignedCompanies)
                {
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--surface); border-radius: 0.5rem;">
                        <div>
                            <strong>@company.Name</strong>
                            @if (!string.IsNullOrEmpty(company.Slug))
                            {
                                <span style="color: var(--muted); margin-left: 0.5rem;">
                                    (<code>@company.Slug</code>)
                                </span>
                            }
                        </div>
                        <form method="post" asp-page-handler="Enter" style="display:inline;">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="companyId" value="@company.Id" />
                            <button type="submit" class="btn btn-primary" style="font-size: 0.9rem;">
                                @Localizer["ViewAsManager"]
                            </button>
                        </form>
                    </div>
                }
            </div>
        }
        else
        {
            <p style="color: var(--muted); text-align: center; padding: 2rem;">
                @Localizer["NotAssignedToAnyCompanies"]
            </p>
        }
    </div>
}

<div style="margin-top: 1rem; padding: 1rem; background: var(--surface); border-left: 4px solid var(--warning); border-radius: 0.5rem;">
    <small style="color: var(--muted);">
        <strong>@Localizer["Important"]</strong> @Localizer["ViewAsModeInfo"]
    </small>
</div>
