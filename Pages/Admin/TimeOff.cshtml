@page
@model ShiftManager.Pages.Admin.TimeOffModel
@using Microsoft.Extensions.Localization
@inject IStringLocalizer<ShiftManager.Resources.SharedResources> Localizer
@{
    Layout = "_Layout";
}

<h2>@Localizer["ManageApprovedTimeOffPage"]</h2>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: var(--success); color: white; border-radius: 0.5rem;">
        @Model.Message
    </div>
}

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger" style="margin-bottom: 2rem; padding: 1rem; background: var(--danger); color: white; border-radius: 0.5rem;">
        @Model.Error
    </div>
}

<div class="card">
    <h3 style="margin-top:0; color: var(--text);">@Localizer["ApprovedTimeOffRequests"]</h3>

    @if (Model.ApprovedTimeOffs.Any())
    {
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border);">
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">@Localizer["Employee"]</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">@Localizer["Dates"]</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">@Localizer["Reason"]</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">@Localizer["RequestedOn"]</th>
                        <th style="text-align: center; padding: 0.75rem; color: var(--text); font-weight: 600;">@Localizer["Actions"]</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var timeOff in Model.ApprovedTimeOffs)
                    {
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 0.75rem; color: var(--text);">
                                <strong>@timeOff.UserName</strong>
                            </td>
                            <td style="padding: 0.75rem; color: var(--text);">
                                @timeOff.StartDate.ToString("MMM dd, yyyy")
                                @if (timeOff.StartDate != timeOff.EndDate)
                                {
                                    <span> â†’ @timeOff.EndDate.ToString("MMM dd, yyyy")</span>
                                }
                                <br>
                                <small style="color: var(--muted);">
                                    @{
                                        var days = timeOff.EndDate.DayNumber - timeOff.StartDate.DayNumber + 1;
                                    }
                                    (@days @(days == 1 ? Localizer["DayDuration"] : Localizer["DaysDuration"]))
                                </small>
                            </td>
                            <td style="padding: 0.75rem; color: var(--text); max-width: 200px;">
                                @if (!string.IsNullOrEmpty(timeOff.Reason))
                                {
                                    <span>@timeOff.Reason</span>
                                }
                                else
                                {
                                    <em style="color: var(--muted);">@Localizer["NoReasonProvided"]</em>
                                }
                            </td>
                            <td style="padding: 0.75rem; color: var(--text);">
                                @timeOff.CreatedAt.ToString("MMM dd, yyyy")
                                <br>
                                <small style="color: var(--muted);">@timeOff.CreatedAt.ToString("HH:mm")</small>
                            </td>
                            <td style="padding: 0.75rem; text-align: center;">
                                @if (timeOff.StartDate > DateOnly.FromDateTime(DateTime.Today))
                                {
                                    <form method="post" asp-page-handler="Delete" style="display: inline;"
                                          onsubmit="return confirm('@string.Format(Localizer["TimeOffDeletionConfirmation"], timeOff.UserName)');">
                                        <input type="hidden" name="id" value="@timeOff.Id" />
                                        <button type="submit" class="btn btn-danger" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
                                            @Localizer["Delete"]
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <span style="color: var(--muted); font-size: 0.85rem;">
                                        @if (timeOff.StartDate == DateOnly.FromDateTime(DateTime.Today))
                                        {
                                            <text>@Localizer["ActiveToday"]</text>
                                        }
                                        else
                                        {
                                            <text>@Localizer["Past"]</text>
                                        }
                                    </span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div style="margin-top: 1rem; padding: 1rem; background: var(--surface); border-left: 4px solid var(--primary); border-radius: 0.5rem;">
            <small style="color: var(--muted);">
                <strong>@Localizer["Note"]:</strong> @Localizer["TimeOffDeletionNote"]
            </small>
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 3rem; color: var(--muted);">
            <h4 style="margin-bottom: 1rem; color: var(--muted);">@Localizer["NoApprovedTimeOffRequests"]</h4>
            <p>@Localizer["NoApprovedTimeOffMessage"]</p>
            <a href="/Requests" class="btn btn-primary" style="margin-top: 1rem;">
                @Localizer["ViewPendingRequests"]
            </a>
        </div>
    }
</div>

<div style="margin-top: 2rem; text-align: center;">
    <a href="/Requests" class="btn btn-ghost">@Localizer["BackToPendingRequests"]</a>
    <a href="/Admin/Users" class="btn btn-ghost" style="margin-left: 1rem;">@Localizer["ManageUsers"]</a>
</div>