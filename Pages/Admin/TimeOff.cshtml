@page
@model ShiftManager.Pages.Admin.TimeOffModel
@{
    Layout = "_Layout";
}

<h2>Manage Approved Time-Off</h2>

@if (!string.IsNullOrEmpty(Model.Message))
{
    <div class="alert alert-success" style="margin-bottom: 2rem; padding: 1rem; background: var(--success); color: white; border-radius: 0.5rem;">
        @Model.Message
    </div>
}

@if (!string.IsNullOrEmpty(Model.Error))
{
    <div class="alert alert-danger" style="margin-bottom: 2rem; padding: 1rem; background: var(--danger); color: white; border-radius: 0.5rem;">
        @Model.Error
    </div>
}

<div class="card">
    <h3 style="margin-top:0; color: var(--text);">Approved Time-Off Requests</h3>

    @if (Model.ApprovedTimeOffs.Any())
    {
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="border-bottom: 2px solid var(--border);">
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">Employee</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">Dates</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">Reason</th>
                        <th style="text-align: left; padding: 0.75rem; color: var(--text); font-weight: 600;">Requested On</th>
                        <th style="text-align: center; padding: 0.75rem; color: var(--text); font-weight: 600;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var timeOff in Model.ApprovedTimeOffs)
                    {
                        <tr style="border-bottom: 1px solid var(--border);">
                            <td style="padding: 0.75rem; color: var(--text);">
                                <strong>@timeOff.UserName</strong>
                            </td>
                            <td style="padding: 0.75rem; color: var(--text);">
                                @timeOff.StartDate.ToString("MMM dd, yyyy")
                                @if (timeOff.StartDate != timeOff.EndDate)
                                {
                                    <span> ‚Üí @timeOff.EndDate.ToString("MMM dd, yyyy")</span>
                                }
                                <br>
                                <small style="color: var(--muted);">
                                    @{
                                        var days = timeOff.EndDate.DayNumber - timeOff.StartDate.DayNumber + 1;
                                    }
                                    (@days day@(days == 1 ? "" : "s"))
                                </small>
                            </td>
                            <td style="padding: 0.75rem; color: var(--text); max-width: 200px;">
                                @if (!string.IsNullOrEmpty(timeOff.Reason))
                                {
                                    <span>@timeOff.Reason</span>
                                }
                                else
                                {
                                    <em style="color: var(--muted);">No reason provided</em>
                                }
                            </td>
                            <td style="padding: 0.75rem; color: var(--text);">
                                @timeOff.CreatedAt.ToString("MMM dd, yyyy")
                                <br>
                                <small style="color: var(--muted);">@timeOff.CreatedAt.ToString("HH:mm")</small>
                            </td>
                            <td style="padding: 0.75rem; text-align: center;">
                                @if (timeOff.StartDate > DateOnly.FromDateTime(DateTime.Today))
                                {
                                    <form method="post" asp-page-handler="Delete" style="display: inline;"
                                          onsubmit="return confirm('Are you sure you want to delete this approved time-off for @timeOff.UserName? This action cannot be undone.');">
                                        <input type="hidden" name="id" value="@timeOff.Id" />
                                        <button type="submit" class="btn btn-danger" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;">
                                            üóëÔ∏è Delete
                                        </button>
                                    </form>
                                }
                                else
                                {
                                    <span style="color: var(--muted); font-size: 0.85rem;">
                                        @if (timeOff.StartDate == DateOnly.FromDateTime(DateTime.Today))
                                        {
                                            <text>Active Today</text>
                                        }
                                        else
                                        {
                                            <text>Past</text>
                                        }
                                    </span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <div style="margin-top: 1rem; padding: 1rem; background: var(--surface); border-left: 4px solid var(--primary); border-radius: 0.5rem;">
            <small style="color: var(--muted);">
                <strong>Note:</strong> You can only delete future time-off requests. Requests that have already started or are in the past cannot be deleted.
                Deleting a time-off request will not automatically restore any shift assignments that were removed when it was approved.
            </small>
        </div>
    }
    else
    {
        <div style="text-align: center; padding: 3rem; color: var(--muted);">
            <h4 style="margin-bottom: 1rem; color: var(--muted);">No Approved Time-Off Requests</h4>
            <p>There are currently no approved time-off requests in the system.</p>
            <a href="/Requests" class="btn btn-primary" style="margin-top: 1rem;">
                View Pending Requests
            </a>
        </div>
    }
</div>

<div style="margin-top: 2rem; text-align: center;">
    <a href="/Requests" class="btn btn-ghost">‚Üê Back to Pending Requests</a>
    <a href="/Admin/Users" class="btn btn-ghost" style="margin-left: 1rem;">Manage Users</a>
</div>